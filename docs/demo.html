<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åŒ—äº¬æ•…åœ°é‡æ¸¸ - ä¸‰æ—¥ç²¾å½©è¡Œç¨‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" />
    <style>
      :root {
        --primary-color: #ff6b95; /* ç²‰çº¢è‰²ä¸»è‰²è°ƒ */
        --secondary-color: #70a6ff; /* è“è‰²æ¬¡è¦è‰²è°ƒ */
        --accent-color: #ffa582; /* æ©™è‰²å¼ºè°ƒè‰² */
        --light-bg: #fff6f8; /* æµ…ç²‰èƒŒæ™¯ */
        --light-blue: #f0f8ff; /* æµ…è“èƒŒæ™¯ */
        --text-color: #343a40; /* æ·±ç°è‰²æ–‡å­— */
        --title-color: #ff5a89; /* æ·±ç²‰è‰²æ ‡é¢˜ */
        --spot-colors: #ff69b4, #ff1493, #ff8fbf, #ff69b4, #ff1493, #ff8fbf, #ff69b4, #ff1493, #ff8fbf, #ff69b4;
        --header-height: 150px; /* æ¡Œé¢ç‰ˆå¤´éƒ¨é«˜åº¦ */
        --header-height-mobile: 100px; /* ç§»åŠ¨ç‰ˆå¤´éƒ¨é«˜åº¦ */
      }

      body {
        font-family: 'Nunito', sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--light-bg);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #ffd6e7 0%, #c1e3ff 100%);
      }

      .header {
        background: linear-gradient(90deg, #ff8eb4 0%, #70a6ff 100%);
        color: white;
        padding: 2rem 0;
        position: relative;
        overflow: hidden;
        margin-bottom: 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('https://img.freepik.com/free-vector/chinese-architecture-landscape-background_52683-44044.jpg') center/cover
          no-repeat;
        opacity: 0.1;
        z-index: 0;
      }

      .header::after {
        /* ç§»é™¤æˆ–è°ƒæ•´åº•éƒ¨æ¸å˜ï¼Œé¿å…è§†è§‰ç©ºéš™ */
        content: none;
        /* æˆ–è€…è°ƒæ•´ä¸º: background: linear-gradient(135deg, transparent 25px, var(--light-bg) 0); */
      }

      .header-content {
        position: relative;
        z-index: 1;
        font-family: cursive, sans-serif;
      }

      .title-chinese {
        font-family: cursive, sans-serif;
        font-weight: 800;
        font-size: 3.4rem;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        margin-bottom: 0.5rem;
        letter-spacing: 1px;
        color: white;
      }

      .subtitle {
        font-size: 1.3rem;
        font-weight: 600;
        opacity: 0.95;
        font-family: cursive, sans-serif;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      .map-wrapper {
        position: relative;
        /* è®¾ç½®èƒŒæ™¯è‰²ä¸bodyä¸€è‡´æ¶ˆé™¤ç©ºéš™ */
        background-color: var(--light-bg);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        margin-bottom: 0;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      #map {
        height: 100%;
        width: 100%;
        flex-grow: 1;
        min-height: 750px;
      }

      .itinerary-panel {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 340px;
        max-height: 700px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 248, 255, 0.9) 100%);
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        z-index: 100;
        overflow: hidden;
        backdrop-filter: blur(10px);
        transition:
          transform 0.3s ease,
          opacity 0.3s ease;
      }

      /* æ”¶èµ·çŠ¶æ€ */
      .itinerary-panel.collapsed {
        transform: translateX(100%);
        opacity: 0;
      }

      /* é¢æ¿åˆ‡æ¢æŒ‰é’® */
      .panel-toggle {
        position: fixed;
        right: 40px;
        bottom: 42px; /* 30px(controlsåº•éƒ¨) + 12px(controlsä¸Špadding) - æŒ‰é’®å‚ç›´å±…ä¸­çš„åç§»é‡ */
        background: rgba(255, 255, 255, 0.9);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 102;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
      }

      .panel-toggle i {
        font-size: 1.5rem;
        color: var(--primary-color);
      }

      .panel-toggle:hover {
        background: linear-gradient(135deg, #4dabf7, #51cf66);
        transform: scale(1.1);
      }

      .panel-toggle:hover i {
        color: white;
      }

      .itinerary-header {
        background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 15px 20px;
        font-weight: 700;
        font-size: 1.2rem;
        border-radius: 12px 12px 0 0;
        margin: 0;
        position: sticky;
        top: 0;
        z-index: 101;
      }

      .itinerary-content {
        max-height: calc(700px - 50px);
        overflow-y: auto;
        padding: 0;
      }

      .weather-panel {
        background: linear-gradient(to right, rgba(77, 171, 247, 0.15), rgba(81, 207, 102, 0.1));
        border-radius: 8px;
        margin-bottom: 1rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        padding: 15px;
      }

      .weather-panel h5 {
        color: var(--accent-color);
        font-weight: 700;
        margin-bottom: 12px;
        font-size: 1.1rem;
      }

      .weather-panel i.bx-cloud,
      .weather-panel i.bx-sun {
        color: var(--primary-color);
      }

      .weather-panel h6 {
        font-weight: 700;
        color: var(--title-color);
      }

      .weather-panel p {
        color: #555;
        font-weight: 500;
      }

      .day-title {
        background: linear-gradient(90deg, var(--secondary-color) 0%, #a57aff 100%);
        color: white;
        padding: 15px;
        border-radius: 8px 8px 0 0;
        margin: 0;
        font-weight: 700;
        font-size: 1.1rem;
        border-bottom: 2px solid var(--light-bg);
      }

      .spot {
        padding: 15px;
        border-bottom: 1px solid #e8f5e9;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .spot:hover,
      .spot.active {
        background: linear-gradient(135deg, var(--light-bg) 0%, var(--light-blue) 100%);
        border-left: 4px solid var(--primary-color);
      }

      /* æ”¹è¿›é€‰ä¸­æ•ˆæœ */
      .spot.active {
        background: linear-gradient(135deg, rgba(255, 107, 149, 0.15) 0%, rgba(112, 166, 255, 0.25) 100%);
        border-left: 4px solid var(--primary-color);
        transform: translateX(4px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      /* é€‰ä¸­æ ‡è®° */
      .spot.active::before {
        content: '';
        position: absolute;
        left: -4px;
        top: 0;
        height: 100%;
        width: 4px;
        background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
      }

      .spot-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .spot-time {
        display: inline-block;
        background-color: var(--primary-color);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 10px;
      }

      .spot-name {
        font-weight: 700;
        margin: 0;
        flex-grow: 1;
        color: var(--title-color);
      }

      .spot-desc {
        color: #444;
        margin-bottom: 8px;
        font-size: 0.95rem;
        font-weight: 500;
      }

      .spot-meta {
        display: flex;
        gap: 15px;
        font-size: 0.85rem;
        color: #718096;
      }

      .spot-meta-item {
        display: flex;
        align-items: center;
      }

      .spot-meta-item i {
        margin-right: 4px;
        color: var(--accent-color);
      }

      .controls {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        display: flex;
        gap: 15px;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 12px 20px;
        border-radius: 50px;
        backdrop-filter: blur(10px);
      }

      .control-btn {
        background: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        font-size: 1.5rem;
        color: var(--primary-color);
        margin: 0 10px;
      }

      .control-btn:hover {
        background: linear-gradient(135deg, #4dabf7, #51cf66);
        transform: scale(1.1);
      }

      .spot-detail {
        display: none;
      }

      /* èŠ‚ç‚¹æ ‡è®°çš„é¢œè‰²æ ·å¼ */
      .marker-spot-0 {
        background-color: #f44336;
      }
      .marker-spot-1 {
        background-color: #e91e63;
      }
      .marker-spot-2 {
        background-color: #9c27b0;
      }
      .marker-spot-3 {
        background-color: #673ab7;
      }
      .marker-spot-4 {
        background-color: #3f51b5;
      }
      .marker-spot-5 {
        background-color: #2196f3;
      }
      .marker-spot-6 {
        background-color: #03a9f4;
      }
      .marker-spot-7 {
        background-color: #00bcd4;
      }
      .marker-spot-8 {
        background-color: #009688;
      }
      .marker-spot-9 {
        background-color: #4caf50;
      }

      @media (max-width: 992px) {
        :root {
          --header-height: var(--header-height-mobile);
        }

        .title-chinese {
          font-size: 2.2rem;
        }

        .subtitle {
          font-size: 1rem;
        }

        #map {
          height: calc(100vh - var(--header-height));
          min-height: auto;
        }

        .itinerary-panel {
          position: fixed;
          top: auto;
          bottom: 80px;
          right: 0;
          width: 90%;
          max-width: 340px;
          max-height: 60vh;
          margin-top: 0;
          border-radius: 12px 0 0 12px;
        }

        .itinerary-panel.collapsed {
          transform: translateX(calc(100% - 40px));
        }

        .controls {
          bottom: 20px;
        }

        /* ä¿®æ”¹ä»¥ç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¸æ§åˆ¶æŒ‰é’®åŒæ­¥è°ƒæ•´ */
        .panel-toggle {
          bottom: 28px; /* 20px(controlsåº•éƒ¨) + 8px(å°å±å¹•controlsä¸Špadding) */
        }
      }

      @media (max-width: 576px) {
        .title-chinese {
          font-size: 1.8rem;
        }

        .subtitle {
          font-size: 0.8rem;
        }

        .header {
          padding: 1rem 0;
        }

        .itinerary-panel {
          width: 85%;
          max-height: 50vh;
        }

        .controls {
          padding: 8px 15px;
        }

        .control-btn {
          width: 40px;
          height: 40px;
          margin: 0 5px;
        }

        /* è¿›ä¸€æ­¥ç¡®ä¿åœ¨å°å±å¹•è®¾å¤‡ä¸Šçš„åŒæ­¥è°ƒæ•´ */
        .panel-toggle {
          width: 40px;
          height: 40px;
        }
      }

      /* ä¿®æ”¹æ ‡è®°ç‚¹æ ·å¼ */
      .custom-marker {
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .custom-marker div {
        padding: 6px 10px; /* ç¼©å°padding */
        border-radius: 20px;
        display: flex;
        align-items: center;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        color: #ffffff; /* æ›´é†’ç›®çš„å­—ä½“é¢œè‰² */
        font-weight: 700; /* åŠ ç²— */
        font-size: 0.9rem; /* ç¼©å°å­—ä½“ */
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); /* æ·»åŠ æ–‡å­—é˜´å½±å¢åŠ å¯è¯»æ€§ */
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .custom-marker.spot-0 div {
        background: linear-gradient(135deg, #ff6b6b, #ffe66d);
      }
      .custom-marker.spot-1 div {
        background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      }
      .custom-marker.spot-2 div {
        background: linear-gradient(135deg, #96e6a1, #d4fc79);
      }
      .custom-marker.spot-3 div {
        background: linear-gradient(135deg, #fda7df, #d980fa);
      }
      .custom-marker.spot-4 div {
        background: linear-gradient(135deg, #a8e6cf, #dcedc1);
      }
      .custom-marker.spot-5 div {
        background: linear-gradient(135deg, #ff6b6b, #ffe66d);
      }
      .custom-marker.spot-6 div {
        background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      }
      .custom-marker.spot-7 div {
        background: linear-gradient(135deg, #96e6a1, #d4fc79);
      }
      .custom-marker.spot-8 div {
        background: linear-gradient(135deg, #fda7df, #d980fa);
      }
      .custom-marker.spot-9 div {
        background: linear-gradient(135deg, #a8e6cf, #dcedc1);
      }

      /* é€‰ä¸­çš„æ ‡è®°æ”¾å¤§æ•ˆæœ */
      .custom-marker.active {
        z-index: 200;
      }

      .custom-marker.active div {
        transform: scale(1.15);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      /* æ·»åŠ åºå·æ ·å¼ */
      .marker-number {
        background: rgba(255, 255, 255, 0.3);
        width: 22px; /* ç¨å¾®ç¼©å° */
        height: 22px; /* ç¨å¾®ç¼©å° */
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 6px; /* ç¼©å°é—´è· */
        font-weight: bold;
      }

      /* æ›´æ–°æ—¥æœŸå’Œæ—¶é—´æ ·å¼ */
      .spot-time {
        background-color: var(--primary-color);
      }

      /* æ·»åŠ è¿›åº¦æ¡æ ·å¼ */
      .progress-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 4px;
        z-index: 1001;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        width: 0%;
        transition: width 0.3s ease;
      }

      /* æ·»åŠ è„‰å†²åŠ¨ç”»å…³é”®å¸§ */
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="header text-center">
      <div class="container header-content">
        <h1 class="title-chinese">åŒ—äº¬æ•…åœ°é‡æ¸¸</h1>
        <p class="subtitle">ä¸‰å¤©ç²¾å½©è¡Œç¨‹ | 2024å¹´5æœˆ30æ—¥ - 6æœˆ1æ—¥</p>
      </div>
    </div>

    <div class="map-wrapper">
      <div id="map"></div>

      <div class="itinerary-panel">
        <div class="itinerary-header">
          <h4>è¡Œç¨‹è·¯çº¿è§„åˆ’</h4>
        </div>
        <div class="itinerary-content">
          <div class="weather-panel">
            <h5><i class="bx bx-cloud"></i> å¤©æ°”é¢„æŠ¥</h5>
            <div id="weather-info" class="mt-2">
              <div class="d-flex align-items-center">
                <i class="bx bx-sun fs-2 me-3"></i>
                <div>
                  <h6 class="mb-1">åŒ—äº¬</h6>
                  <p class="mb-0">æ™´æœ— 25Â°C</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Day 1 -->
          <div class="day-section mb-3">
            <h4 class="day-title">Day 1 - 5æœˆ30æ—¥</h4>
            <div class="spot" data-id="spot1" data-day="1">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot2" data-day="1">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot3" data-day="1">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
          </div>

          <!-- Day 2 -->
          <div class="day-section mb-3">
            <h4 class="day-title">Day 2 - 5æœˆ31æ—¥</h4>
            <div class="spot" data-id="spot4" data-day="2">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot5" data-day="2">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot6" data-day="2">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
          </div>

          <!-- Day 3 -->
          <div class="day-section">
            <h4 class="day-title">Day 3 - 6æœˆ1æ—¥</h4>
            <div class="spot" data-id="spot7" data-day="3">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot8" data-day="3">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
            <div class="spot" data-id="spot9" data-day="3">
              <div class="spot-header">
                <span class="spot-time"></span>
                <h5 class="spot-name"></h5>
              </div>
              <p class="spot-desc"></p>
              <div class="spot-meta">
                <div class="spot-meta-item"><i class="bx bx-time"></i></div>
                <div class="spot-meta-item"><i class="bx bx-money"></i></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="control-btn" id="playBtn" title="æ’­æ”¾è·¯çº¿åŠ¨ç”»">
          <i class="bx bx-play"></i>
        </button>
        <button class="control-btn" id="overviewBtn" title="æ˜¾ç¤ºå®Œæ•´è·¯çº¿">
          <i class="bx bx-map-alt"></i>
        </button>
      </div>

      <button class="panel-toggle" id="panelToggle" title="æŸ¥çœ‹è¡Œç¨‹è¯¦æƒ…">
        <i class="bx bx-list-ul"></i>
      </button>

      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
    </div>

    <div class="progress-container">
      <div class="progress-bar"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=3cdb60742465c1e86b6133e6a2a26ff5"></script>
    <script>
      // æ™¯ç‚¹é…ç½®æ•°æ®
      const SPOTS_CONFIG = [
        // ç¬¬ä¸€å¤©
        {
          id: 'spot1',
          location: [116.398019, 39.87272], // ç²¾ç¡®æ ¸å¯¹çš„æ°¸å®šé—¨åŸæ¥¼åæ ‡
          time: '09:00',
          name: 'æ°¸å®šé—¨åŸæ¥¼',
          description: 'æ˜æ¸…æ—¶æœŸé‡è¦åŸé—¨ï¼Œç°ä¸ºåŒ—äº¬å¤ä»£å»ºç­‘åšç‰©é¦†',
          fee: '20å…ƒ/äºº',
          duration: '1.5å°æ—¶',
          day: 1,
          icon: 'ğŸ¯' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot2',
          location: [116.380696, 39.874088], // ç”¨æˆ·æä¾›çš„é™¶ç„¶äº­å…¬å›­ç²¾ç¡®åæ ‡
          time: '11:00',
          name: 'é™¶ç„¶äº­å…¬å›­',
          description: 'æ¸…ä»£åå›­ï¼Œä»¥äº­å¾—åï¼Œæ¹–å…‰å±±è‰²ï¼Œç¯å¢ƒä¼˜ç¾',
          fee: '10å…ƒ/äºº',
          duration: '1.5å°æ—¶',
          day: 1,
          icon: 'ğŸï¸' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot3',
          location: [116.407526, 39.882218], // å¤©å›å…¬å›­åæ ‡
          time: '14:00',
          name: 'å¤©å›å…¬å›­',
          description: 'ä¸–ç•Œæ–‡åŒ–é—äº§ï¼Œæ˜æ¸…ä¸¤ä»£å¸ç‹ç¥­å¤©åœºæ‰€',
          fee: '35å…ƒ/äºº',
          duration: '3å°æ—¶',
          day: 1,
          icon: 'â›©ï¸' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        // ç¬¬äºŒå¤©
        {
          id: 'spot4',
          location: [116.401148, 39.896135], // ç”¨æˆ·æä¾›çš„å‰é—¨å¤§è¡—ç²¾ç¡®åæ ‡
          time: '09:00',
          name: 'å‰é—¨å¤§è¡—',
          description: 'è€åŒ—äº¬å•†ä¸šè¡—ï¼Œä¼ ç»Ÿå»ºç­‘ç¾¤',
          fee: 'å…è´¹',
          duration: '2å°æ—¶',
          day: 2,
          icon: 'ğŸ®' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot5',
          location: [116.392465, 39.905219], // ç”¨æˆ·æä¾›çš„äººæ°‘å¤§ä¼šå ‚ç²¾ç¡®åæ ‡
          time: '12:00',
          name: 'äººæ°‘å¤§ä¼šå ‚',
          description: 'ä¸­å›½æœ€é«˜å›½å®¶æƒåŠ›æœºå…³åŠå…¬åœ°ï¼Œæ”¿æ²»ä¸­å¿ƒ',
          fee: '30å…ƒ/äºº',
          duration: '2å°æ—¶',
          day: 2,
          icon: 'ğŸ›ï¸' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot6',
          location: [116.397452, 39.906073], // å¤©å®‰é—¨å¹¿åœºåæ ‡
          time: '15:00',
          name: 'å¤©å®‰é—¨å¹¿åœº',
          description: 'ä¸–ç•Œæœ€å¤§åŸå¸‚ä¸­å¿ƒå¹¿åœº',
          fee: 'å…è´¹',
          duration: '2å°æ—¶',
          day: 2,
          icon: 'ğŸ›ï¸' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        // ç¬¬ä¸‰å¤©
        {
          id: 'spot7',
          location: [116.397026, 39.918058], // æ•…å®«åšç‰©é™¢åæ ‡
          time: '09:00',
          name: 'æ•…å®«åšç‰©é™¢',
          description: 'ä¸–ç•Œæœ€å¤§çš„å®«æ®¿å»ºç­‘ç¾¤ï¼Œä¸­å›½æ˜æ¸…ä¸¤ä»£çš„çš‡å®¶å®«æ®¿',
          fee: '60å…ƒ/äºº',
          duration: '4å°æ—¶',
          day: 3,
          icon: 'ğŸ¯' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot8',
          location: [116.386795, 39.926984], // ç²¾ç¡®æ ¸å¯¹çš„åŒ—æµ·å…¬å›­åæ ‡
          time: '14:00',
          name: 'åŒ—æµ·å…¬å›­',
          description: 'çš‡å®¶å›­æ—ï¼Œåƒå¹´å†å²æ–‡åŒ–é—å€',
          fee: '20å…ƒ/äºº',
          duration: '2å°æ—¶',
          day: 3,
          icon: 'ğŸï¸' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        },
        {
          id: 'spot9',
          location: [116.403366, 39.936812], // å—é”£é¼“å··åæ ‡
          time: '17:00',
          name: 'å—é”£é¼“å··',
          description: 'è€åŒ—äº¬èƒ¡åŒæ–‡åŒ–ï¼Œä¼ ç»Ÿå°åƒä¸ç‰¹è‰²å•†é“º',
          fee: 'å…è´¹',
          duration: '2å°æ—¶',
          day: 3,
          icon: 'ğŸ®' // æ·»åŠ æ™¯ç‚¹å›¾æ ‡
        }
      ];

      // å…¨å±€å˜é‡
      let map,
        markers = [],
        polyline,
        animatedPolyline,
        currentIndex = -1;
      let timer = null,
        animationPaused = true;
      let spots = [];
      let drawTimer = null;
      let completedSegments = [];

      // åˆå§‹åŒ–åœ°å›¾
      function initMap() {
        map = new AMap.Map('map', {
          zoom: 11,
          center: [116.4, 39.9],
          viewMode: '2D', // ä½¿ç”¨2Dæ¨¡å¼
          mapStyle: 'amap://styles/fresh',
          animateEnable: true
        });

        // æ·»åŠ åœ°å›¾æ§ä»¶
        map.plugin(['AMap.Scale'], function () {
          map.addControl(new AMap.Scale());
        });

        // ä½¿ç”¨é…ç½®æ•°æ®åˆå§‹åŒ–æ™¯ç‚¹
        initSpots();

        // åˆ›å»ºæ ‡è®°å’Œè·¯çº¿
        createMarkersAndRoute();

        // ç»‘å®šäº‹ä»¶
        bindEvents();

        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
        checkMobileDevice();

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°æ£€æµ‹
        window.addEventListener('resize', checkMobileDevice);
      }

      // ä»é…ç½®æ•°æ®åˆå§‹åŒ–æ™¯ç‚¹
      function initSpots() {
        // æ¸…ç©ºç°æœ‰æ•°æ®
        spots = [];

        // è·å–æ‰€æœ‰æ™¯ç‚¹DOMå…ƒç´ 
        const spotElements = document.querySelectorAll('.spot');

        // ä»é…ç½®æ•°æ®åˆ›å»ºæ™¯ç‚¹å¯¹è±¡
        SPOTS_CONFIG.forEach((config, index) => {
          const spotData = {
            id: config.id,
            location: config.location,
            time: config.time,
            name: config.name,
            description: config.description,
            fee: config.fee,
            duration: config.duration,
            element: spotElements[index],
            day: config.day,
            icon: config.icon || 'ğŸ“' // ä½¿ç”¨é…ç½®çš„å›¾æ ‡æˆ–é»˜è®¤å›¾æ ‡
          };
          spots.push(spotData);

          // åŒæ—¶æ›´æ–°DOMå…ƒç´ çš„æ•°æ®å±æ€§
          if (spotElements[index]) {
            spotElements[index].dataset.location = config.location.join(',');
            spotElements[index].dataset.time = config.time;
            spotElements[index].dataset.name = config.name;
            spotElements[index].dataset.description = config.description;
            spotElements[index].dataset.fee = config.fee;
            spotElements[index].dataset.duration = config.duration;

            // æ›´æ–°DOMå…ƒç´ å†…éƒ¨çš„æ˜¾ç¤ºå†…å®¹
            const timeElement = spotElements[index].querySelector('.spot-time');
            const nameElement = spotElements[index].querySelector('.spot-name');
            const descElement = spotElements[index].querySelector('.spot-desc');
            const durationElement = spotElements[index].querySelector('.spot-meta-item:first-child');
            const feeElement = spotElements[index].querySelector('.spot-meta-item:last-child');

            if (timeElement) timeElement.textContent = config.time;
            if (nameElement) nameElement.textContent = config.name;
            if (descElement) descElement.textContent = config.description;
            if (durationElement) durationElement.innerHTML = `<i class="bx bx-time"></i> ${config.duration}`;
            if (feeElement) feeElement.innerHTML = `<i class="bx bx-money"></i> ${config.fee}`;
          }
        });
      }

      // åˆ›å»ºæ‰€æœ‰æ ‡è®°ç‚¹å’Œè·¯çº¿
      function createMarkersAndRoute() {
        // æ¸…ç©ºç°æœ‰æ ‡è®°
        markers.forEach(marker => marker.setMap(null));
        markers = [];

        if (polyline) {
          polyline.setMap(null);
          polyline = null;
        }

        // åˆ›å»ºæ ‡è®°ç‚¹
        spots.forEach((spot, index) => {
          // ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè‡ªå®šä¹‰æ ‡è®°å†…å®¹
          const markerContent = document.createElement('div');
          markerContent.className = `custom-marker spot-${index}`;
          markerContent.innerHTML = `
            <div>
              <span class="marker-number">${index + 1}</span>
              <span>${spot.icon || ''} ${spot.name}</span>
            </div>
          `;

          const marker = new AMap.Marker({
            position: spot.location,
            map: map,
            content: markerContent,
            offset: new AMap.Pixel(-10, -20),
            zIndex: 100
          });

          // ç‚¹å‡»æ ‡è®°æ—¶é«˜äº®æ˜¾ç¤º
          marker.on('click', () => {
            currentIndex = index;
            highlightSpot(index);
          });

          markers.push(marker);
        });

        // åˆ›å»ºè™šçº¿è·¯å¾„ï¼ˆèƒŒæ™¯è·¯çº¿ï¼‰
        const path = spots.map(spot => spot.location);
        polyline = new AMap.Polyline({
          path: path,
          strokeColor: '#cccccc',
          strokeWeight: 4,
          strokeOpacity: 0.6,
          strokeStyle: 'dashed',
          strokeDasharray: [5, 5],
          zIndex: 50
        });
        polyline.setMap(map);

        // è°ƒæ•´åœ°å›¾è§†é‡ä»¥åŒ…å«æ‰€æœ‰æ ‡è®°ç‚¹
        map.setFitView(markers);
      }

      // æ·»åŠ ä¸­å›½é£æ°´å¢¨ç”»æ•ˆæœæ°´å°
      function addWatermark() {
        // åˆ›å»ºæ°´å°å±‚
        const watermark = document.createElement('div');
        watermark.style.cssText = `
          position: absolute;
          bottom: 30px;
          left: 30px;
          opacity: 0.1;
          pointer-events: none;
          z-index: 50;
        `;
        watermark.innerHTML = `
          <svg width="200" height="150" viewBox="0 0 200 150">
            <path d="M20,80 Q50,20 80,80 T140,80" stroke="#000" stroke-width="8" fill="none" />
            <path d="M40,100 Q70,60 100,100 T160,100" stroke="#000" stroke-width="8" fill="none" />
          </svg>
        `;
        document.querySelector('.map-wrapper').appendChild(watermark);
      }

      // æ˜¾ç¤ºæ™¯ç‚¹è¯¦æƒ…
      function showSpotDetail(index) {
        const spot = spots[index];
        const detailEl = document.querySelector('.spot-detail');

        // æ›´æ–°è¯¦æƒ…å†…å®¹
        detailEl.querySelector('.detail-name').textContent = spot.name;
        detailEl.querySelector('.detail-time').textContent = spot.time;
        detailEl.querySelector('.detail-desc').textContent = spot.description;
        detailEl.querySelector('.detail-duration').textContent = `å»ºè®®æ¸¸è§ˆï¼š${spot.duration}`;
        detailEl.querySelector('.detail-fee').textContent = `é—¨ç¥¨ï¼š${spot.fee}`;

        // æ˜¾ç¤ºè¯¦æƒ…é¢æ¿
        detailEl.classList.add('active');

        // åœ°å›¾èšç„¦åˆ°è¯¥ç‚¹
        map.setCenter(spot.location);
        map.setZoom(14);
      }

      // ä¿®æ”¹å¹³æ»‘è®¾ç½®åœ°å›¾è§†å›¾å‡½æ•°
      function smoothSetMapView(viewPoints, padding = [60, 60, 60, 60]) {
        // è®¡ç®—è¾¹ç•Œ
        const bounds = new AMap.Bounds();
        viewPoints.forEach(point => {
          bounds.extend(point.getPosition());
        });

        // è·å–ä¸­å¿ƒç‚¹
        const targetCenter = bounds.getCenter();

        // ä½¿ç”¨å¹³æ»‘ç§»åŠ¨
        map.panTo(targetCenter);

        // å¦‚æœéœ€è¦è°ƒæ•´ç¼©æ”¾çº§åˆ«ï¼Œä½¿ç”¨å¹³æ»‘ç¼©æ”¾
        const targetZoom = Math.min(map.getFitZoomByBounds(bounds, padding), 14);
        if (map.getZoom() !== targetZoom) {
          map.setZoom(targetZoom);
        }
      }

      // ä¿®æ”¹æ’­æ”¾ä¸‹ä¸€æ®µè·¯çº¿çš„å‡½æ•°
      function playNextSegment() {
        if (animationPaused) return;

        if (currentIndex < spots.length - 1) {
          const nextIndex = currentIndex + 1;

          // è·å–å½“å‰ç‚¹å’Œä¸‹ä¸€ä¸ªç‚¹çš„ä½ç½®
          const currentLoc = currentIndex > -1 ? spots[currentIndex].location : spots[0].location;
          const nextLoc = spots[nextIndex].location;

          // è®¡ç®—ä¸¤ç‚¹ä¸­å¿ƒç‚¹
          const centerLat = (currentLoc[1] + nextLoc[1]) / 2;
          const centerLng = (currentLoc[0] + nextLoc[0]) / 2;

          // è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆå…¬é‡Œæ•°ï¼‰
          const distance = Math.sqrt(Math.pow(currentLoc[0] - nextLoc[0], 2) + Math.pow(currentLoc[1] - nextLoc[1], 2)) * 111; // å¤§è‡´è½¬æ¢ä¸ºå…¬é‡Œ

          // æ ¹æ®è·ç¦»è°ƒæ•´ç¼©æ”¾çº§åˆ«ï¼Œè·ç¦»è¶Šå¤§ç¼©æ”¾çº§åˆ«è¶Šå°
          let zoom = 14; // é»˜è®¤ç¼©æ”¾çº§åˆ«

          if (distance < 0.5)
            zoom = 15; // 500ç±³ä»¥å†…
          else if (distance < 2)
            zoom = 14; // 2å…¬é‡Œä»¥å†…
          else if (distance < 5)
            zoom = 13; // 5å…¬é‡Œä»¥å†…
          else if (distance < 10)
            zoom = 12; // 10å…¬é‡Œä»¥å†…
          else zoom = 11; // æ›´è¿œè·ç¦»

          // å¹³æ»‘è®¾ç½®åœ°å›¾è§†é‡ï¼Œç¡®ä¿ä¸¤ç‚¹éƒ½åœ¨è§†é‡å†…
          map.setZoomAndCenter(zoom, [centerLng, centerLat], false, 600);

          // é«˜äº®å½“å‰å’Œä¸‹ä¸€ä¸ªç‚¹
          highlightSpot(nextIndex);

          // ç»˜åˆ¶è·¯çº¿
          drawAnimatedLine(currentIndex > -1 ? currentIndex : 0, nextIndex, () => {
            currentIndex = nextIndex;

            // ç«‹å³ç»§ç»­æ’­æ”¾ä¸‹ä¸€æ®µ
            if (!animationPaused) {
              playNextSegment();
            }
          });
        } else {
          pauseRouteAnimation();
          // æ’­æ”¾å®Œæ¯•ï¼Œæ˜¾ç¤ºå…¨æ™¯å›¾
          showFullRouteMap();
        }
      }

      // ç»˜åˆ¶åŠ¨ç”»è·¯çº¿
      function drawAnimatedLine(startIndex, endIndex, callback) {
        const startPoint = spots[startIndex].location;
        const endPoint = spots[endIndex].location;

        // è·å–è·¯çº¿é¢œè‰²
        const pathColor = getColorForIndex(startIndex);

        // ç”Ÿæˆè·¯å¾„ç‚¹
        const pathPoints = [];
        const pointCount = 100; // å¢åŠ ç‚¹çš„æ•°é‡ä½¿è·¯å¾„æ›´å¹³æ»‘

        // åˆ›å»ºåˆå§‹è·¯çº¿
        let polyline = new AMap.Polyline({
          path: [startPoint],
          strokeColor: pathColor,
          strokeWeight: 6,
          strokeOpacity: 0.8,
          lineJoin: 'round',
          lineCap: 'round',
          zIndex: 90,
          showDir: true
        });
        polyline.setMap(map);

        // è®¡ç®—æ‰€æœ‰ç‚¹çš„ä½ç½®
        for (let i = 0; i <= pointCount; i++) {
          const ratio = i / pointCount;
          const lng = startPoint[0] + (endPoint[0] - startPoint[0]) * ratio;
          const lat = startPoint[1] + (endPoint[1] - startPoint[1]) * ratio;
          pathPoints.push([lng, lat]);
        }

        // åˆ›å»ºç»˜åˆ¶åŠ¨ç”»
        let currentPoint = 0;
        const animationStep = 3; // æ¯æ¬¡å¢åŠ çš„ç‚¹æ•°ï¼Œä»2å¢åŠ åˆ°3ï¼ŒåŠ å¿«ç»˜åˆ¶é€Ÿåº¦
        const drawInterval = 40; // åŠ¨ç”»é—´éš”æ—¶é—´ï¼Œä»50å‡å°‘åˆ°40ï¼ŒåŠ å¿«ç»˜åˆ¶é€Ÿåº¦

        const drawTimer = setInterval(() => {
          currentPoint += animationStep;

          if (currentPoint >= pathPoints.length) {
            // åŠ¨ç”»å®Œæˆ
            clearInterval(drawTimer);

            // ä¿å­˜è·¯çº¿
            if (!completedSegments.includes(polyline)) {
              completedSegments.push(polyline);
            }

            if (callback) {
              setTimeout(callback, 400); // ä»500å‡å°‘åˆ°400ï¼ŒåŠ å¿«è½¬åœºé€Ÿåº¦
            }
            return;
          }

          // æ›´æ–°è·¯å¾„
          polyline.setPath(pathPoints.slice(0, currentPoint + 1));
        }, drawInterval);

        return polyline;
      }

      // è·å–é¢œè‰²å‡½æ•°
      function getColorForIndex(index) {
        const colors = [
          '#ff6b95', // ç²‰çº¢
          '#70a6ff', // è“è‰²
          '#ffa582', // æ©™è‰²
          '#fd7e14', // æ·±æ©™
          '#f06595', // æ·±ç²‰
          '#ff6b95', // ç²‰çº¢
          '#70a6ff', // è“è‰²
          '#ffa582', // æ©™è‰²
          '#fd7e14', // æ·±æ©™
          '#f06595' // æ·±ç²‰
        ];
        return colors[index % colors.length];
      }

      // ä¿®æ”¹é«˜äº®æ˜¾ç¤ºå‡½æ•°
      function highlightSpot(index) {
        // é«˜äº®å½“å‰æ™¯ç‚¹å¡ç‰‡
        spots.forEach((spot, i) => {
          if (i === index) {
            spot.element.classList.add('active');
            // å¹³æ»‘æ»šåŠ¨åˆ°é€‰ä¸­çš„æ™¯ç‚¹å¡ç‰‡
            spot.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            spot.element.classList.remove('active');
          }
        });

        // é«˜äº®å¯¹åº”çš„æ ‡è®°
        markers.forEach((marker, i) => {
          const markerEl = marker.getContent();
          if (i === index) {
            markerEl.classList.add('active');
            // ä¸ºé€‰ä¸­çš„æ ‡è®°æ·»åŠ è„‰å†²åŠ¨ç”»æ•ˆæœ
            markerEl.style.animation = 'pulse 1.5s infinite';
          } else {
            markerEl.classList.remove('active');
            markerEl.style.animation = '';
          }
        });
      }

      // æ’­æ”¾è·¯çº¿åŠ¨ç”»
      function playRouteAnimation() {
        // æ€»æ˜¯ä»å¤´å¼€å§‹æ’­æ”¾
        resetRouteAnimation(true);

        animationPaused = false;
        const playBtn = document.getElementById('playBtn');
        playBtn.innerHTML = '<i class="bx bx-pause"></i>';
        playBtn.onclick = pauseRouteAnimation;

        // ç«‹å³å¼€å§‹æ’­æ”¾ï¼Œæ— éœ€å»¶æ—¶
        playNextSegment();
      }

      // æš‚åœè·¯çº¿åŠ¨ç”»
      function pauseRouteAnimation() {
        if (animationPaused) return;

        animationPaused = true;
        clearInterval(timer);
        clearInterval(drawTimer);

        const playBtn = document.getElementById('playBtn');
        playBtn.innerHTML = '<i class="bx bx-play"></i>';
        playBtn.onclick = playRouteAnimation;
      }

      // ä¿®æ”¹é‡ç½®åŠ¨ç”»å‡½æ•°
      function resetRouteAnimation(keepPaused = false) {
        pauseRouteAnimation();

        // æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„çº¿æ®µ
        completedSegments.forEach(segment => {
          if (segment) segment.setMap(null);
        });
        completedSegments = [];

        currentIndex = -1;

        // é‡ç½®æ‰€æœ‰æ ‡è®°å’Œæ™¯ç‚¹é«˜äº®
        markers.forEach(marker => {
          const markerEl = marker.getContent();
          markerEl.classList.remove('active');
        });

        spots.forEach(spot => {
          spot.element.classList.remove('active');
        });

        // å¹³æ»‘ç§»åŠ¨åˆ°èµ·ç‚¹
        if (spots.length > 0) {
          map.panTo(spots[0].location);
        }

        if (!keepPaused) {
          const playBtn = document.getElementById('playBtn');
          playBtn.innerHTML = '<i class="bx bx-play"></i>';
          playBtn.onclick = playRouteAnimation;
        }
      }

      // å±•ç¤ºå®Œæ•´è·¯çº¿åœ°å›¾
      function showFullRouteMap() {
        // è®¾ç½®è§†å›¾åŒ…å«æ‰€æœ‰æ ‡è®°ç‚¹
        map.setFitView(markers, false, [80, 80, 80, 80]);
      }

      // ç»‘å®šäº‹ä»¶
      function bindEvents() {
        // æ’­æ”¾æŒ‰é’® - æ€»æ˜¯ä»å¤´å¼€å§‹æ’­æ”¾
        const playBtn = document.getElementById('playBtn');
        playBtn.onclick = playRouteAnimation;

        // æ¦‚è§ˆæŒ‰é’® - å±•ç¤ºå®Œæ•´è·¯çº¿
        document.getElementById('overviewBtn').addEventListener('click', showFullRouteMap);

        // ç‚¹å‡»æ™¯ç‚¹å¡ç‰‡
        spots.forEach((spot, index) => {
          spot.element.addEventListener('click', () => {
            // æš‚åœå½“å‰åŠ¨ç”»
            pauseRouteAnimation();

            // æ¸…é™¤å·²æœ‰çº¿æ¡
            if (animatedPolyline) {
              animatedPolyline.setMap(null);
              animatedPolyline = null;
            }

            // è®¾ç½®å½“å‰ç´¢å¼•
            currentIndex = index;

            // é«˜äº®æ˜¾ç¤º
            highlightSpot(index);
          });
        });

        // é¢æ¿åˆ‡æ¢æŒ‰é’®
        document.getElementById('panelToggle').addEventListener('click', togglePanel);
      }

      // æ›´æ–°æŒ‰é’®çŠ¶æ€å‡½æ•°
      function updateToggleButton(collapsed) {
        const toggleBtn = document.getElementById('panelToggle');
        if (collapsed) {
          toggleBtn.innerHTML = '<i class="bx bx-list-ul"></i>';
          toggleBtn.setAttribute('title', 'æŸ¥çœ‹è¡Œç¨‹è¯¦æƒ…');
        } else {
          toggleBtn.innerHTML = '<i class="bx bx-x"></i>';
          toggleBtn.setAttribute('title', 'å…³é—­è¡Œç¨‹è¯¦æƒ…');
        }
      }

      // ä¿®æ”¹åˆ‡æ¢é¢æ¿å‡½æ•°
      function togglePanel() {
        const panel = document.querySelector('.itinerary-panel');
        const isCollapsed = panel.classList.contains('collapsed');

        // åˆ‡æ¢é¢æ¿çŠ¶æ€
        panel.classList.toggle('collapsed');

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        updateToggleButton(!isCollapsed);
      }

      // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
      function checkMobileDevice() {
        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡æˆ–å°å±å¹•
        const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isSmallScreen = window.innerWidth <= 992;
        const shouldHidePanel = isMobileDevice || isSmallScreen;
        const panel = document.querySelector('.itinerary-panel');

        // æ ¹æ®è®¾å¤‡ç±»å‹è°ƒæ•´é¡µé¢å…ƒç´ 
        if (shouldHidePanel) {
          // åœ¨ç§»åŠ¨è®¾å¤‡æˆ–å°å±å¹•ä¸Šé»˜è®¤æ”¶èµ·é¢æ¿
          panel.classList.add('collapsed');

          // æ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºå±•å¼€
          updateToggleButton(true);

          // è®¾ç½®é¢æ¿çš„æ ·å¼ï¼Œç¡®ä¿ç§»åŠ¨è®¾å¤‡ä¸Šæ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
          panel.style.maxHeight = '70vh';
        } else {
          // åœ¨æ¡Œé¢è®¾å¤‡ä¸Šé»˜è®¤å±•å¼€é¢æ¿
          panel.classList.remove('collapsed');

          // æ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºå…³é—­
          updateToggleButton(false);
        }

        // è°ƒæ•´æ§åˆ¶æŒ‰é’®çš„ä½ç½®ï¼Œç¡®ä¿åœ¨å°å±å¹•ä¸Šä¸è¢«é®æŒ¡
        if (isSmallScreen) {
          const controls = document.querySelector('.controls');
          controls.style.bottom = '15px';

          // åŒæ­¥è°ƒæ•´é¢æ¿åˆ‡æ¢æŒ‰é’®çš„ä½ç½®
          const panelToggle = document.getElementById('panelToggle');
          panelToggle.style.bottom = '23px'; // 15px + 8px padding
        } else {
          // é‡ç½®ä¸ºé»˜è®¤ä½ç½®
          const controls = document.querySelector('.controls');
          controls.style.bottom = '30px';

          // åŒæ­¥è°ƒæ•´é¢æ¿åˆ‡æ¢æŒ‰é’®çš„ä½ç½®
          const panelToggle = document.getElementById('panelToggle');
          panelToggle.style.bottom = '42px'; // 30px + 12px padding
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.onload = function () {
        initMap();

        // æ£€æµ‹è®¾å¤‡ç±»å‹
        checkMobileDevice();

        // æ›´æ–°æ¦‚è§ˆæŒ‰é’®çš„å›¾æ ‡
        document.getElementById('overviewBtn').innerHTML = '<i class="bx bx-map-alt"></i>';

        // æ·»åŠ çª—å£å¤§å°å˜åŒ–äº‹ä»¶ç›‘å¬ï¼ŒåŠ¨æ€è°ƒæ•´ç•Œé¢
        window.addEventListener('resize', function () {
          // å»¶è¿Ÿæ‰§è¡Œä»¥é¿å…é¢‘ç¹è§¦å‘
          if (this.resizeTimer) clearTimeout(this.resizeTimer);
          this.resizeTimer = setTimeout(function () {
            checkMobileDevice();
          }, 300);
        });

        // ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ å±å¹•æ–¹å‘å˜åŒ–æ£€æµ‹
        window.addEventListener('orientationchange', function () {
          setTimeout(checkMobileDevice, 300);
        });
      };
    </script>
  </body>
</html>
